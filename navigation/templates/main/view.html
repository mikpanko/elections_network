{% load elements %}

{% include "dialogs/find_uik.html" %}

{% if request.user.is_authenticated %}
    {% if not request.profile.has_name %}
        <div class="check-list-step"><i>+1<br/>балл</i>
            <p>Введите свои имя и фамилию:</p>

            <form action="{% url update_profile %}?fields=first_name,last_name" method="post">
                {% csrf_token %}
                <div style="display:inline; float: right;">
                    {% button "circle-check" "Сохранить" "save_name" "" "" %}
                </div>
                <div style="margin:0.3em;">Имя: {{ form.first_name }}</div>
                <div style="margin:0.3em;">Фамилия: {{ form.last_name }}</div>
            </form>
        </div>
    {% endif %}

    {% if not request.profile.show_name %}
        <div class="check-list-step {% if not request.profile.has_name %}disabled-block{% endif %}"><i>+2<br/>балла</i>
            {% if not request.profile.has_name %}<div class="i">&nbsp;</div>{% endif %}
            <p>Покажите свое имя остальным пользователям. Это увеличит доверие к вам на площадке.</p>
            <form action="{% url update_profile %}?fields=show_name" method="post">
                {% csrf_token %}
                {{ form.show_name }}
                <div style="display:inline;">
                    {% button "circle-check" "Сохранить" "save_show_name" "" "" %}
                </div>
            </form>
        </div>
    {% endif %}

    {% if not request.roles.voter %}
        <div class="check-list-step"><i>+2<br/>балла</i>
            <p>Выберите район, где вы проживаете и/или будете голосовать.</p>

            <form id="become_voter_form" method="post" action="{% url become_voter %}">
                {% csrf_token %}
                <div id="choose_regions">
                    {% include "elements/region_choice.html" %}
                </div>
            </form>
            <div style="display: inline;">
                {% button "circle-check" "Сохранить" "choose_region" "" "" %}
            </div>
        </div>

        <script type="text/javascript">
            set_select_location("choose_regions", []);
            init_find_uik();

            $("#choose_region").click(function(){
                signup_for_role("voter", "{% url main %}");
            });
        </script>
    {% endif %}

    <div class="check-list-step"><i>+1<br/>балл</i>
        <p>"Полюбите" нас в соцсетях и расскажите о нас своим друзьям</p>
        <div>
            {% include "elements/share_horizontal.html" %}
        </div>
        или подпишитесь на нас:
        <div>
            {% include "elements/read_us.html" %}
        </div>
    </div>

    <div class="check-list-step"><i>+3<br/>балла</i>
        <p>Стать активным участником на выборах</p>

        {% if roles %}
            <ul>
                {% include "elements/roles.html" %}
            </ul>
        {% endif %}

        <div class="user_actions">
            {% button "circle-check" "Наблюдатель" "become_observer1" "" "" %}
            {% button "circle-check" "Член комиссии" "become_member1" "" "" %}
            {% button "circle-check" "Представитель СМИ" "become_journalist1" "" "" %}

        </div>

        <div class="user_actions">
            {% button "circle-check" "Юрист" "become_lawyer1" "" "" %}
            {% button "circle-check" "Представитель прокуратуры" "become_prosecutor1" "" "" %}
            {% button "circle-check" "Представитель власти" "become_authority1" "" "" %}
        </div>
    </div>

    {% with btn_id="become_observer1" role="observer" status_plural="наблюдатели" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_member1" role="member" status_plural="члены комиссии" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_journalist1" role="journalist" status_plural="представители СМИ" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_lawyer1" role="lawyer" status_plural="юристы" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_prosecutor1" role="prosecutor" status_plural="представители прокуратуры" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_authority1" role="authority" status_plural="представители власти" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% if not request.profile.about %}
        <script src="{{ STATIC_URL }}libs/tiny_mce/tiny_mce.js" type="text/javascript"></script>
        <div class="check-list-step"><i>+3<br/>балла</i>
            <p>Добавьте информацию о себе. Вы можете оставить свои координаты,
            написать про учавстие в выборах и как готовность помочь другим участникам.</p>
            <form action="{% url update_profile %}?fields=about" method="post">
                {% csrf_token %}
                <div style=" overflow: hidden;">
                    {{ form.about }}
                </div>
                <div>
                    {% button "circle-check" "Добавить" "save_about" "" "" %}
                </div>
            </form>
        </div>
    {% endif %}
{% else %}
    <h2>Что такое Гракон?</h2>
    <p>Гракон - мини-соцсеть для координации работы любых организаций и граждан,
    объединенных одной целью - <b>проведением честных выборов</b> президента 4 марта.

    Удобная структура площадки позволяет участникам эффективно находить поблизости
    именно тех людей и группы, которые могут им помочь. В результате активные участники
    могут скоординировать свои действия в день выборов и минимизировать шансы
    возникновения нарушений на участках.
    </p>

    {% button "circle-check" "Короткая презентация" "view_presentation" "" %}

    {% include "dialogs/presentation.html" %}

    <h2>Примите участие!</h2>

    <div class="step"><i>1</i> <p>Найдите <b>свой избирательный участок</b> и
            посмотрите, как проходят выборы в вашем городе:</p>
        <div id="choose_regions">
            {% include "elements/region_choice.html" %}
            <div style="display: inline;">
                {% button "arrowreturnthick-1-e" "Перейти" "goto_location" "" "" %}
            </div>
            &nbsp; &nbsp; <b>или</b>&nbsp; &nbsp;
            <div style="display: inline;">
                {% button "circle-zoomout" "Найти на карте" "map_location" "" "" %}
            </div>
        </div>
    </div>

    <div class="step"><i>2</i>
        <p>Хотите получать <b>новости</b> о ходе выборов в вашем городе?</p>
        <div>{% button "circle-check" "Подписаться" "login_content1" "" "" %}</div>
    </div>

    <div class="step"><i>3</i>
        <p>Хотите помочь проведению честных выборов, но нет возможности стать наблюдателем?</p>
        <ul>
            <li>Станьте <b>веб-наблюдателем</b> и следите за ходом выборов на своем участке через веб камеру.</li>
            <li>Войдите в состав <b>мобильной группы</b> для отлова "карусельщиков".</li>
        </ul>
        <div>{% button "circle-check" "Записаться" "login_content2" "" "" %}</div>
    </div>

    <div class="step"><i>4</i>
        <p>Уже записались <b>наблюдателем</b> или <b>членом избирательной комиссии</b>?
        Найдите других наблюдателей на вашем участке.
        </p>
        <div>{% button "circle-check" "Регистрация" "login_content3" "" "" %}</div>
    </div>

    <div class="step"><i>5</i>
        <p>Следите за <b>новостями проекта</b></p>
        {% include "elements/read_us.html" %}
    </div>

    <script type="text/javascript">
        set_select_location("choose_regions", []);
        $("#login_content1, #login_content2, #login_content3").click(function(){
            login_dialog_init("Войдите в систему, используя логин/email или свой аккаунт на других сервисах");
        });
        $("#view_presentation").click(function(){presentation_dialog_init();});
    </script>
{% endif %}
