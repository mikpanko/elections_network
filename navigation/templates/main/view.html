{% load elements %}

{% include "dialogs/find_uik.html" %}

{% if request.user.is_authenticated %}
    {% if not request.profile.has_name %}
        <div class="check-list-step"><i>+1<br/>балл</i>
            <p>Введите свои имя и фамилию:</p>

            <form action="{% url update_profile %}?fields=first_name,last_name" method="post">
                {% csrf_token %}
                <div style="display:inline; float: right;">
                    {% button "circle-check" "Сохранить" "save_name" "" "" %}
                </div>
                <div style="margin:0.3em;">Имя: {{ form.first_name }}</div>
                <div style="margin:0.3em;">Фамилия: {{ form.last_name }}</div>
            </form>
        </div>
    {% endif %}

    {% if not request.profile.show_name %}
        <div class="check-list-step {% if not request.profile.has_name %}disabled-block{% endif %}"><i>+2<br/>балла</i>
            {% if not request.profile.has_name %}<div class="i">&nbsp;</div>{% endif %}
            <p>Покажите свое имя остальным пользователям. Это увеличит доверие к вам на площадке.</p>
            <form action="{% url update_profile %}?fields=show_name" method="post">
                {% csrf_token %}
                {{ form.show_name }}
                <div style="display:inline;">
                    {% button "circle-check" "Сохранить" "save_show_name" "" "" %}
                </div>
            </form>
        </div>
    {% endif %}

    {% if not request.roles.voter %}
        <div class="check-list-step"><i>+2<br/>балла</i>
            <p>Выберите район, где вы проживаете и/или будете голосовать.</p>

            <form id="become_voter_form" method="post" action="{% url become_voter %}">
                {% csrf_token %}
                <div id="choose_regions">
                    {% include "elements/region_choice.html" %}
                </div>
            </form>
            <div style="display: inline;">
                {% button "circle-check" "Сохранить" "choose_region" "" "" %}
            </div>
        </div>

        <script type="text/javascript">
            set_select_location("choose_regions", []);
            init_find_uik();

            $("#choose_region").click(function(){
                signup_for_role("voter", "{% url main %}");
            });
        </script>
    {% endif %}

    <div class="check-list-step"><i>+1<br/>балл</i>
        <p>"Полюбите" нас в соцсетях и расскажите о нас своим друзьям</p>
        <div>
            {% include "elements/share_horizontal.html" %}
        </div>
        или подпишитесь на нас:
        <div>
            {% include "elements/read_us.html" %}
        </div>
    </div>

    <div class="check-list-step"><i>+3<br/>балла</i>
        <p>Стать активным участником на выборах</p>

        {% if roles %}
            <ul>
                {% include "elements/roles.html" %}
            </ul>
        {% endif %}

        <div class="user_actions">
            {% button "circle-check" "Наблюдатель" "become_observer1" "" "" %}
            {% button "circle-check" "Член комиссии" "become_member1" "" "" %}
            {% button "circle-check" "Представитель СМИ" "become_journalist1" "" "" %}

        </div>

        <div class="user_actions">
            {% button "circle-check" "Юрист" "become_lawyer1" "" "" %}
            {% button "circle-check" "Представитель прокуратуры" "become_prosecutor1" "" "" %}
            {% button "circle-check" "Представитель власти" "become_authority1" "" "" %}
        </div>
    </div>

    {% with btn_id="become_observer1" role="observer" status_plural="наблюдатели" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_member1" role="member" status_plural="члены комиссии" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_journalist1" role="journalist" status_plural="представители СМИ" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_lawyer1" role="lawyer" status_plural="юристы" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_prosecutor1" role="prosecutor" status_plural="представители прокуратуры" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% with btn_id="become_authority1" role="authority" status_plural="представители власти" %}
        {% include "elements/dialog_open_button.html" %}
    {% endwith %}

    {% if not request.profile.about %}
        <script src="{{ STATIC_URL }}libs/tiny_mce/tiny_mce.js" type="text/javascript"></script>
        <div class="check-list-step"><i>+3<br/>балла</i>
            <p>Добавьте информацию о себе. Вы можете оставить свои координаты,
            написать про учавстие в выборах и как готовность помочь другим участникам.</p>
            <form action="{% url update_profile %}?fields=about" method="post">
                {% csrf_token %}
                <div style=" overflow: hidden;">
                    {{ form.about }}
                </div>
                <div>
                    {% button "circle-check" "Добавить" "save_about" "" "" %}
                </div>
            </form>
        </div>
    {% endif %}
{% else %}
    <h2>Что такое Гракон?</h2>
    <p>Гракон - мини-соцсеть для координации работы любых организаций и граждан,
    объединенных одной целью - <b>проведением честных выборов</b> президента 4 марта.

    Удобная структура площадки позволяет участникам эффективно находить поблизости
    именно тех людей и группы, которые могут им помочь. В результате активные участники
    могут скоординировать свои действия в день выборов и минимизировать шансы
    возникновения нарушений на участках.
    </p>

    <h2>Примите участие!</h2>

    <div class="step"><i>1</i> <p>Найдите свой избирательный округ и посмотрите, как проходят выборы в Вашем городе:</p>
        <div id="choose_regions">
            {% include "elements/region_choice.html" %}
            <div style="display: inline;">
                {% button "arrowreturnthick-1-e" "Перейти" "goto_location" "" "" %}
            </div>
            &nbsp; &nbsp; <b>или</b>&nbsp; &nbsp;
            <div style="display: inline;">
                {% button "circle-zoomout" "Найти на карте" "map_location" "" "" %}
            </div>
        </div>
    </div>


    <div class="step"><i>2</i>
        {% if request.user.is_authenticated %}
            <p>Начните участвовать в работе на своем избирательном участке.
            Для этого выберите свою роль на выборах в панели слева и запишитесь.</p>
        {% else %}
            <p>Начните участвовать в работе на своем избирательном участке.
            Для этого необходимо зарегистрироваться.
            </p>
            <div>{% button "circle-check" "Регистрация" "login_content" "" "" %}</div>
        {% endif %}
    </div>


    <div class="step"><i>3</i>
        <div style="margin-bottom: 7px;">следить за новостями проекта</div>
        {% include "elements/read_us.html" %}
    </div>

    <script type="text/javascript">
        set_select_location("choose_regions", []);
        $("#login_content").click(function(){
            login_dialog_init("Войдите в систему, используя логин/email или свой аккаунт на других сервисах");
        });
    </script>

    <h2>Презентация</h2>
    <script>
        $(document).ready(function(){
            function resizeSlide() {
                jQuery("#__ss_11568118").css('width','100%').find('iframe').css('width','100%');
                var slideHeight = jQuery("#__ss_11568118").width()/1.1917;
                jQuery("#__ss_11568118").css('height',slideHeight).find('iframe').css('height',slideHeight);
                jQuery("#player div").css('background-color', '#fff');              
            }
            resizeSlide();
            $(window).resize(function() {
                resizeSlide();
            });
        });
    </script>

    <p>Нажмите на иконку <img src="{{ STATIC_URL }}images/fullscreen.gif" align="absmiddle" style="padding: 3px; border: 1px solid #ccc; border-radius: 5px;" /> в правом нижнем углу презентации для полноэкранного просмотра</p>
    <div id="__ss_11568118" style="border: 1px solid #ccc; width:100%"><iframe src="http://www.slideshare.net/slideshow/embed_code/11568118" width="100%" height="420" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></div>
{% endif %}
